function initApp(){firebase.auth().onAuthStateChanged(function(e){if(e){userId=firebase.auth().currentUser.uid;var t=firebase.database().ref("/users/"+userId);t.child("history").on("value",function(e){if(e.exists()){var t=[];for(var a in e.val())if(e.val().hasOwnProperty(a)){var n=e.val()[a];t.push({url:n.url,changes:n.changes,changes_percentage:n.changes_percentage,date:n.date})}printHistory(t)}else console.log("no history")}),t.on("value",function(e){null!=e.val()?chosenColor(e.val().highlight_color):console.log("new user")}),t.child("followed_links").on("value",function(e){if(null!=e.val()){var t=[];for(var a in e.val())if(e.val().hasOwnProperty(a)){var n=e.val()[a];t.push(n.url)}printLinks(t)}else console.log("no links")})}else startAuth(!0)})}function chosenColor(e){document.getElementById("hi-color").setAttribute("value",e)}function printLinks(e){$(".followed table").empty();for(var t=0;t<e.length;t++)element=e[t],$("<tr></tr>").appendTo(".followed table"),$(".followed table tr:last-of-type").append($("<td></td>").text(t+1),$("<td></td>").text(e[t]),$('<td class=" remove" onclick="deleteLink(\''+e[t]+'\')"><span class="glyphicon glyphicon-remove"></span><span class="hidden-xs">Remove</span></td>'))}function printHistory(e){var t=$(".history table");t.empty(),$("<tr><th>No.</th><th>URL</th><th>Changes</th><th>% Changed</th><th>Date</th></tr>").appendTo(t);for(var a=0;a<e.length;a++){var n=e[a];$("<tr></tr>").appendTo(t),$(".history table tr:last-of-type").append($("<td></td>").text(a+1),$("<td></td>").text(n.url),$("<td></td>").text(n.changes),$("<td></td>").text(n.changes_percentage),$("<td></td>").text(n.date))}}function deleteLink(e){var t=firebase.auth().currentUser.uid,a=firebase.database().ref("/users/"+t+"/followed_links");a.orderByChild("url").equalTo(e).once("value",function(e){if(e.exists()){console.log("will delete");var t=Object.keys(e.val())[0];a.child(t).child("url").set(null)}})}function downloadObjectAsJson(e,t){var a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",t+".json"),n.click(),n.remove()}function startAuth(e){var t=new firebase.auth.GoogleAuthProvider;firebase.auth().signInWithRedirect(t),firebase.auth().getRedirectResult().then(function(e){if(e.credential)e.credential.accessToken;e.user;console.log(e)}).catch(function(e){console.log(e);e.code,e.message,e.email,e.credential})}var config={authDomain:"cliw-test.firebaseapp.com",apiKey:"AIzaSyDNynAgYGkrXFQfoPrY2iScW8aT28yQmYk",databaseURL:"https://cliw-test.firebaseio.com",storageBucket:"gs://cliw-test.appspot.com/"};firebase.initializeApp(config),document.addEventListener("DOMContentLoaded",function(e){document.querySelector("#addPageModal .btn-success").addEventListener("click",function(e){var t=document.querySelector("#addPageModal #url").value,a=new RegExp(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi);if(t.match(a)){var n=firebase.auth().currentUser.uid,o=firebase.database().ref("/users/"+n+"/followed_links"),r=o.push().key;o.child(r).set({url:t})}else alert("Invalid url");document.querySelector("#addPageModal #url").value=""}),document.querySelector("#options .download").addEventListener("click",function(e){var t=firebase.auth().currentUser.uid;firebase.database().ref("/users/"+t).once("value",function(e){e.exists()&&downloadObjectAsJson(e.val(),"settings")}),document.querySelector("#addPageModal #url").value=""})}),window.onload=function(){initApp()};